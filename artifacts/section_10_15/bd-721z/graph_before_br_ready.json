[
  {
    "acceptance_criteria": "- Ambient network/spawn/time effects in restricted modules fail CI; allowlist is explicit and signed.",
    "assignee": "PurpleHarbor",
    "created_at": "2026-02-20T07:36:59.726628519Z",
    "created_by": "ubuntu",
    "description": "## Why This Exists\nHard Runtime Invariant #10 from Section 8.5 mandates \"no ambient authority\" — control-plane modules must not directly access network sockets, spawn OS processes, read wall-clock time, or perform filesystem I/O without going through capability-gated APIs provided by the asupersync correctness kernel. Ambient authority makes code untestable in deterministic lab environments, breaks cancellation propagation (network calls ignore Cx deadlines), and prevents the evidence ledger from recording causal chains. This bead adds a CI gate that audits control-plane modules for ambient authority usage and fails the build when violations are found outside an explicit, signed allowlist.\n\n## What This Must Do\n1. Implement `tools/lints/ambient_authority_gate.rs` — an analysis pass that:\n   - Scans control-plane modules (`crates/franken-node/src/connector/`, `crates/franken-node/src/conformance/`) for direct usage of: `std::net::*`, `std::process::Command`, `std::time::Instant`/`SystemTime`, `std::fs::*`, `tokio::net::*`, `tokio::process::*`, `tokio::time::sleep`/`timeout` (without Cx), `tokio::spawn` (without region ownership).\n   - Reads a signed allowlist (`docs/specs/ambient_authority_allowlist.toml`) with entries: module path, permitted ambient API, justification, signer, expiry date.\n   - Emits structured JSON findings with per-module/per-call pass/fail/allowed status.\n2. Author `docs/specs/ambient_authority_policy.md` defining:\n   - The complete list of restricted ambient APIs.\n   - The allowlist signing and review process.\n   - The escalation path for new exceptions.\n3. Generate `artifacts/10.15/ambient_authority_findings.json` containing per-module audit results.\n\n## Acceptance Criteria\n- Ambient network/spawn/time effects in restricted modules fail CI; allowlist is explicit and signed.\n- The gate operates on actual import/usage analysis, not just `use` statements (catches `std::net::TcpStream::connect` even without a `use` import).\n- Unsigned or expired allowlist entries are treated as violations.\n- Adding a direct `tokio::spawn` in a connector module without an allowlist entry causes immediate CI failure.\n- The findings JSON is consumed by the section gate (bd-20eg) and the observability dashboards (bd-3gnh).\n\n## Testing & Logging Requirements\n- **Unit tests**: Validate the gate against synthetic modules — one clean, one with direct `std::net` usage, one with allowlisted usage, one with expired allowlist.\n- **Integration tests**: Run against the real crate and assert zero non-allowlisted violations.\n- **Adversarial tests**: Inject `std::process::Command::new(\"rm\")` into a connector module and assert detection. Test with a forged (unsigned) allowlist entry.\n- **Structured logs**: Event codes `AMB-001` (module clean), `AMB-002` (ambient authority violation), `AMB-003` (allowlisted usage), `AMB-004` (allowlist entry expired/invalid). Include module path, API call site (file:line), and allowlist entry ID.\n\n## Expected Artifacts\n- `tools/lints/ambient_authority_gate.rs`\n- `docs/specs/ambient_authority_policy.md`\n- `artifacts/10.15/ambient_authority_findings.json`\n- `artifacts/section_10_15/bd-721z/verification_evidence.json`\n- `artifacts/section_10_15/bd-721z/verification_summary.md`\n\n## Dependencies\n- **Upstream**: None within 10.15 (standalone audit gate)\n- **Downstream**: bd-20eg (section gate)",
    "id": "bd-721z",
    "issue_type": "task",
    "notes": "Taking over blocked bead for closure audit: ambient-authority gate deliverables + evidence refresh.",
    "priority": 1,
    "status": "in_progress",
    "title": "[10.15] Add ambient-authority audit gate for control-plane modules.",
    "updated_at": "2026-02-22T03:14:23.080782052Z"
  }
]
